<!--
Google IO 2012/2013 HTML5 Slide Template

Authors: Eric Bidelman <ebidel@gmail.com>
         Luke Mahé <lukem@google.com>

URL: https://code.google.com/p/io-2012-slides
--><!DOCTYPE html>


<html>
<head>
  <title>Problem Set 4 : KEY &mdash; Genome Informatics Workshop 0.2 documentation</title>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">-->
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0">-->
  <!--This one seems to work all the time, but really small on ipad-->
  <!--<meta name="viewport" content="initial-scale=0.4">-->
  <meta name="apple-mobile-web-app-capable" content="yes">
  
  <link rel="stylesheet" media="all"
        href="../../_static/theme/css/default.css">
  <link rel="stylesheet" media="all"
        href="../../_static/theme/css/hieroglyph.css">
  <link rel="stylesheet" media="only screen and (max-device-width: 480px)"
        href="../../_static/theme/css/phone.css">

    

    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <base target="_blank"> <!-- This amazingness opens all links in a new tab. -->
  
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>

    <script data-main="../../_static/js/slides"
            src="../../_static/js/require-1.0.8.min.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="top" title="Genome Informatics Workshop 0.2 documentation" href="../../index.html" />
    <link rel="up" title="Problem Set : KEYS" href="../Problem_Set_Keys.html" />
    <link rel="next" title="Problem Set 5 : KEY" href="problem-set-5-key.html" />
    <link rel="prev" title="Problem Set 3 : KEY" href="problem-set-3-key.html" /> 

<!-- Google Analytics tracking code -->
<!--        DO NOT REMOVE           -->
<!--           JRH                  -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-47837611-1', 'ucd-bioworkshop.github.io');
  ga('send', 'pageview');

</script>


</head>
<body style="opacity: 0">

<slides class="layout-widescreen">

    <slide class="title-slide segue nobackground">
    <aside class="gdbar"><img src="images/google_developers_icon_128.png"></aside>
    <!-- The content of this hgroup is replaced programmatically through the slide_config.json. -->
    <hgroup class="auto-fadein">
      <h1 data-config-title><!-- populated from slide_config.json --></h1>
      <h2 data-config-subtitle><!-- populated from slide_config.json --></h2>
      <p data-config-presenter><!-- populated from slide_config.json --></p>
    </hgroup>
  </slide>

  
    <slide class="level-1">
    <hgroup>
      <h1>Problem Set 4 : KEY<a class="headerlink" href="../../../Problem_Sets/problem-set-keys/problem-set-4-key.html#problem-set-4-key" title="View HTML">§</a></h1>
    </hgroup>
    <article class="">
      <p>Here is bash script that runs the following Python program:</p>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#! /usr/bin/env bash</span>

<span class="c"># run script for Problem Set 4 key</span>

<span class="nv">project</span><span class="o">=</span><span class="s2">&quot;$HOME/devel/bio-workshop/problem-set-keys/problem-set-4&quot;</span>
<span class="nv">bedfile</span><span class="o">=</span><span class="s2">&quot;$project/data/2014-02-2/lamina.bed&quot;</span>
u

<span class="nv">result</span><span class="o">=</span><span class="s2">&quot;$project/results/2014-02-24&quot;</span>
<span class="nv">results</span><span class="o">=</span><span class="s2">&quot;$project/results/2014-02-24/result.tab&quot;</span>

<span class="k">if</span> <span class="o">[</span> ! -d <span class="nv">$result</span> <span class="o">]</span>; <span class="k">then</span>
<span class="k">    </span>mkdir -p <span class="nv">$result</span>
<span class="k">fi</span>

<span class="c"># run out of current directory</span>
python problem-4.py <span class="nv">$bedfile</span> &gt;&gt; <span class="nv">$results</span>
</pre></div>
</td></tr></table></div>
<p>Here is the Python code for the Problems:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#! /usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">itemgetter</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s">&quot;error: specify bed file&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">parse_bed</span><span class="p">(</span><span class="n">bedfilename</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; parse records and return each record &#39;&#39;&#39;</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">bedfilename</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">):</span>
            <span class="k">continue</span>

        <span class="n">chrom</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;chrom&#39;</span><span class="p">:</span><span class="n">chrom</span><span class="p">,</span> <span class="s">&#39;start&#39;</span><span class="p">:</span><span class="n">start</span><span class="p">,</span> <span class="s">&#39;end&#39;</span><span class="p">:</span><span class="n">end</span><span class="p">,</span> <span class="s">&#39;value&#39;</span><span class="p">:</span><span class="n">value</span><span class="p">}</span>
        <span class="k">yield</span> <span class="n">result</span>

<span class="c"># for 1.</span>
<span class="n">prev_start</span> <span class="o">=</span> <span class="bp">None</span>
<span class="c"># for 2.</span>
<span class="n">coverage</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="n">bedfilename</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">parse_bed</span><span class="p">(</span><span class="n">bedfilename</span><span class="p">):</span>

    <span class="n">cur_start</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">]</span>

    <span class="c"># 1. calculate the distance between the start of the current record</span>
    <span class="c"># and the previous record. note you may need to define a variable</span>
    <span class="c"># outside of this loop.</span>

    <span class="c"># this runs the *second* time through the loop, as prev_start is not</span>
    <span class="c"># defined until a start is seen</span>
    <span class="k">if</span> <span class="n">prev_start</span><span class="p">:</span>
        <span class="n">start_dist</span> <span class="o">=</span> <span class="n">cur_start</span> <span class="o">-</span> <span class="n">prev_start</span>

        <span class="c"># XXX uncomment the next line to see the output</span>

        <span class="c"># print &quot;cur start dist is: %d&quot; % start_dist</span>

    <span class="c"># reset for next time through the loop</span>
    <span class="n">prev_start</span> <span class="o">=</span> <span class="n">cur_start</span>

    <span class="c"># 2. calculate the bases covered by the intervals for each</span>
    <span class="c"># chromosome. note you may have to define a structure outside of</span>
    <span class="c"># this loop to keep track of that information.</span>

    <span class="n">cur_cov</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="s">&#39;end&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">record</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">]</span>
    <span class="n">coverage</span><span class="p">[</span><span class="n">record</span><span class="p">[</span><span class="s">&#39;chrom&#39;</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">cur_cov</span>

<span class="c"># print out the coverage for each chromosome</span>
<span class="k">for</span> <span class="n">chrom</span> <span class="ow">in</span> <span class="n">coverage</span><span class="p">:</span>
    <span class="n">cov</span> <span class="o">=</span> <span class="n">coverage</span><span class="p">[</span><span class="n">chrom</span><span class="p">]</span>
    <span class="k">print</span> <span class="s">&quot;coverage on </span><span class="si">%s</span><span class="s"> = </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">chrom</span><span class="p">,</span> <span class="n">cov</span><span class="p">)</span>

<span class="c"># ------------------------------------------------------------------------</span>

<span class="n">struct</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

<span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">parse_bed</span><span class="p">(</span><span class="n">bedfilename</span><span class="p">):</span>
   
    <span class="n">chrom</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="s">&#39;chrom&#39;</span><span class="p">]</span>
    
    <span class="c"># write additional code to get the start and end coordinates from</span>
    <span class="c"># the record</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="s">&#39;start&#39;</span><span class="p">]</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="s">&#39;end&#39;</span><span class="p">]</span>

    <span class="c"># create a tuple of coords. note where we put start and end:</span>
    <span class="c"># coords[0] == start</span>
    <span class="c"># coords[1] == end</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

    <span class="c"># add the coords to the growing list. replace `whichmeth` with the</span>
    <span class="c"># appropriate method call</span>

    <span class="c"># XXX whichmeth == append</span>
    <span class="n">struct</span><span class="p">[</span><span class="n">chrom</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>

<span class="k">for</span> <span class="n">chrom</span> <span class="ow">in</span> <span class="n">struct</span><span class="p">:</span>
    <span class="c"># 1. use max() and min() in this loop to determine biggest start</span>
    <span class="c"># values.</span>

    <span class="c"># max() and min() look at the list of tuples, implicitly sort them by</span>
    <span class="c"># size based on the first position, and then grab the min / max of the</span>
    <span class="c"># sorted values. The `[0]` grabs the first item i.e. the start</span>
    <span class="n">max_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">struct</span><span class="p">[</span><span class="n">chrom</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">min_start</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">struct</span><span class="p">[</span><span class="n">chrom</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c"># 2. how do you change the max() and min() calls to look at the `end`</span>
    <span class="c"># value instead of the `start`?</span>

    <span class="c"># itemgetter is a function that you pass to the key argument to</span>
    <span class="c"># fetch index 1 from the list, in this case index 1 = the `end` value.</span>
    <span class="c"># the `[1]` grabs the second item i.e. the end</span>

    <span class="n">max_end</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">struct</span><span class="p">[</span><span class="n">chrom</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">min_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">struct</span><span class="p">[</span><span class="n">chrom</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c"># XXX: a different approach would be to flip the end and start</span>
    <span class="c"># values above (line 80), and use max() / min() to look at those end</span>
    <span class="c"># values</span>

    <span class="c"># XXX: yet another approach, without itemgetter </span>
    <span class="c"># max_end = max(tup[1] for tup in struct[chrom])</span>
    <span class="c"># min_end = min(tup[1] for tup in struct[chrom])</span>

    <span class="k">print</span> <span class="s">&#39;on chrom </span><span class="si">%s</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="n">chrom</span>
    <span class="k">print</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">starts: min = </span><span class="si">%s</span><span class="s">, max = </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">min_start</span><span class="p">,</span> <span class="n">max_start</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">ends: min = </span><span class="si">%s</span><span class="s">, max = </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">min_end</span><span class="p">,</span> <span class="n">max_end</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>The output of the run script looks like this:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96</pre></div></td><td class="code"><div class="highlight"><pre>coverage on chrY = 14758817
coverage on chrX = 89301074
coverage on chr13 = 37473868
coverage on chr12 = 53348965
coverage on chr11 = 61396658
coverage on chr10 = 53656281
coverage on chr17 = 18144445
coverage on chr16 = 46512191
coverage on chr15 = 25690026
coverage on chr14 = 38559996
coverage on chr19 = 16502427
coverage on chr18 = 36207854
coverage on chr22 = 7387330
coverage on chr20 = 27478916
coverage on chr21 = 9100280
coverage on chr7 = 74721815
coverage on chr6 = 76015525
coverage on chr5 = 88673141
coverage on chr4 = 104526476
coverage on chr3 = 85446412
coverage on chr2 = 100941122
coverage on chr1 = 103132464
coverage on chr9 = 76483798
coverage on chr8 = 71753206
on chrom chrY:
	starts: min = 2940166, max = 15475619
	ends: min = 7172793, max = 19472504
on chrom chrX:
	starts: min = 6179158, max = 153719866
	ends: min = 6932534, max = 153904495
on chrom chr13:
	starts: min = 21089232, max = 110796751
	ends: min = 21389685, max = 112247300
on chrom chr12:
	starts: min = 3306736, max = 129934486
	ends: min = 5048326, max = 130052605
on chrom chr11:
	starts: min = 4126157, max = 132322333
	ends: min = 5170312, max = 133410222
on chrom chr10:
	starts: min = 1193532, max = 129141333
	ends: min = 3050735, max = 131552237
on chrom chr17:
	starts: min = 2886987, max = 68901867
	ends: min = 3374890, max = 69681120
on chrom chr16:
	starts: min = 5093535, max = 82174586
	ends: min = 8544428, max = 82374319
on chrom chr15:
	starts: min = 20639479, max = 99670855
	ends: min = 22659952, max = 100095998
on chrom chr14:
	starts: min = 18155169, max = 103464302
	ends: min = 19837291, max = 103617343
on chrom chr19:
	starts: min = 6821953, max = 61378765
	ends: min = 7001239, max = 61498933
on chrom chr18:
	starts: min = 857086, max = 73058130
	ends: min = 2083983, max = 75203259
on chrom chr22:
	starts: min = 14430269, max = 31610031
	ends: min = 15909210, max = 33980242
on chrom chr20:
	starts: min = 11619, max = 58104509
	ends: min = 194068, max = 58210058
on chrom chr21:
	starts: min = 14398328, max = 39740537
	ends: min = 15147834, max = 39893926
on chrom chr7:
	starts: min = 2947476, max = 158368912
	ends: min = 4615662, max = 158818293
on chrom chr6:
	starts: min = 6703164, max = 166444291
	ends: min = 7041709, max = 166785402
on chrom chr5:
	starts: min = 1715774, max = 180228411
	ends: min = 5463587, max = 180458962
on chrom chr4:
	starts: min = 4938426, max = 190367794
	ends: min = 5707180, max = 191169887
on chrom chr3:
	starts: min = 4513773, max = 195897445
	ends: min = 4992502, max = 196234302
on chrom chr2:
	starts: min = 1829412, max = 239997824
	ends: min = 3344344, max = 240720241
on chrom chr1:
	starts: min = 11323785, max = 245647839
	ends: min = 11617177, max = 247066405
on chrom chr9:
	starts: min = 808574, max = 124952737
	ends: min = 2755227, max = 125061175
on chrom chr8:
	starts: min = 696699, max = 136731831
	ends: min = 1664048, max = 140704572
</pre></div>
</td></tr></table></div>




    </article>
  </slide>


    <slide class="thank-you-slide segue nobackground">
    <aside class="gdbar right"><img src="images/google_developers_icon_128.png"></aside>
    <article class="flexbox vleft auto-fadein">
      <h2>&lt;Thank You!&gt;</h2>
    </article>
    <p class="auto-fadein" data-config-contact>
      <!-- populated from slide_config.json -->
    </p>
  </slide>

  <slide class="backdrop"></slide>

</slides>

<!--[if IE]>
  <script src="http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js"></script>
  <script>CFInstall.check({mode: 'overlay'});</script>
<![endif]-->
</body>
</html>