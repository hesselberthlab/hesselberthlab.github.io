<!--
Google IO 2012/2013 HTML5 Slide Template

Authors: Eric Bidelman <ebidel@gmail.com>
         Luke Mahé <lukem@google.com>

URL: https://code.google.com/p/io-2012-slides
--><!DOCTYPE html>


<html>
<head>
  <title>Class 10 : Applied Python &mdash; Genome Informatics Workshop 0.2 documentation</title>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">-->
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0">-->
  <!--This one seems to work all the time, but really small on ipad-->
  <!--<meta name="viewport" content="initial-scale=0.4">-->
  <meta name="apple-mobile-web-app-capable" content="yes">
  
  <link rel="stylesheet" media="all"
        href="../_static/theme/css/default.css">
  <link rel="stylesheet" media="only screen and (max-device-width: 480px)"
        href="../_static/theme/css/phone.css">

    

    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <base target="_blank"> <!-- This amazingness opens all links in a new tab. -->
  
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>

    <script data-main="../_static/js/slides"
            src="../_static/js/require-1.0.8.min.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="top" title="Genome Informatics Workshop 0.2 documentation" href="../index.html" />
    <link rel="up" title="Class list" href="../Classes.html" />
    <link rel="next" title="Class 11 : Python Idioms" href="class-11.html" />
    <link rel="prev" title="Class 9 : Python Concepts" href="class-9.html" /> 

<!-- Google Analytics tracking code -->
<!--        DO NOT REMOVE           -->
<!--           JRH                  -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-47837611-1', 'ucd-bioworkshop.github.io');
  ga('send', 'pageview');

</script>


</head>
<body style="opacity: 0">

<slides class="layout-widescreen">

    <slide class="title-slide segue nobackground">
    <aside class="gdbar"><img src="images/google_developers_icon_128.png"></aside>
    <!-- The content of this hgroup is replaced programmatically through the slide_config.json. -->
    <hgroup class="auto-fadein">
      <h1 data-config-title><!-- populated from slide_config.json --></h1>
      <h2 data-config-subtitle><!-- populated from slide_config.json --></h2>
      <p data-config-presenter><!-- populated from slide_config.json --></p>
    </hgroup>
  </slide>

  
    <slide class="level-1">
    <hgroup>
      <h1>Class 10 : Applied Python<a class="headerlink" href="../../Classes/class-10.html#class-10-applied-python" title="View HTML">§</a></h1>
    </hgroup>
    <article class="">
      <table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Class date:</th><td class="field-body">Wednesday February 19</td>
</tr>
</tbody>
</table>




    </article>
  </slide>  <slide class="level-2">
    <hgroup>
      <h2>Install Toolshed<a class="headerlink" href="../../Classes/class-10.html#install-toolshed" title="View HTML">§</a></h2>
    </hgroup>
    <article class="">
      <p>Confirm you have the toolshed module installed with:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>python -c <span class="s2">&quot;import toolshed&quot;</span>
</pre></div>
</div>
<p>If you get an error, run this:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>pip install toolshed
</pre></div>
</div>
<p>If you still get an error, ask for help.</p>




    </article>
  </slide>  <slide class="level-2">
    <hgroup>
      <h2>Goals<a class="headerlink" href="../../Classes/class-10.html#goals" title="View HTML">§</a></h2>
    </hgroup>
    <article class="">
      <blockquote>
<div><ol class="arabic simple">
<li>homework review</li>
<li>example application</li>
</ol>
</div></blockquote>




    </article>
  </slide>  <slide class="level-2">
    <hgroup>
      <h2>Homework Review<a class="headerlink" href="../../Classes/class-10.html#homework-review" title="View HTML">§</a></h2>
    </hgroup>
    <article class="">
      <blockquote>
<div><ul class="simple">
<li>Everyone is having trouble with <a class="reference internal" href="../Problem_Sets/problem_set_3/problem_set_3.html#problem-set-3"><em>Problem Set 3</em></a>.</li>
<li>Trouble integrating simple python constructs (dicts, lists, strings) and
logic (if blocks, for loops) to perform some tasks.</li>
<li>Specific questions about homework?</li>
<li>Questions 1, 2.</li>
<li><a class="reference external" href="https://pypi.python.org/pypi/toolshed">toolshed module</a>.</li>
</ul>
</div></blockquote>




    </article>
  </slide>  <slide class="level-2">
    <hgroup>
      <h2>Application Impetus<a class="headerlink" href="../../Classes/class-10.html#application-impetus" title="View HTML">§</a></h2>
    </hgroup>
    <article class="">
      <p>It is helpful to read python code that solves a common problem to
better understand how to use data-structures.</p>
<p>A python script that combines data from two files:</p>
<ol class="arabic simple">
<li>laboratory information on immune cell measurements.</li>
<li>information on a sequencing run for a subset of those samples.</li>
</ol>
<p>This is real data (shuffled to protect innocent mice) and a real python script
(data from Ken Eyring and Ted Shade)</p>




    </article>
  </slide>  <slide class="level-2">
    <hgroup>
      <h2>Data Files<a class="headerlink" href="../../Classes/class-10.html#data-files" title="View HTML">§</a></h2>
    </hgroup>
    <article class="">
      <p>Download these files into &quot;/opt/bio-workshop/data/&quot;</p>
<p><strong>laboratory info:</strong> <a class="reference download internal" href="../_downloads/sample-lab-info.tsv"><tt class="xref download docutils literal"><span class="pre">sample-lab-info.tsv</span></tt></a></p>
<p><strong>sequence info:</strong> <a class="reference download internal" href="../_downloads/sample-seq-info.csv"><tt class="xref download docutils literal"><span class="pre">sample-seq-info.csv</span></tt></a></p>
<p><strong>merging script:</strong> <a class="reference download internal" href="../_downloads/sample-merge.py"><tt class="xref download docutils literal"><span class="pre">sample-merge.py</span></tt></a></p>
<p>Once downloaded, look at the structure of the data files with <cite>less</cite></p>
<p>We will spend this class <em>deriving</em>/<em>understanding</em> <cite>sample-merge.py</cite></p>




    </article>
  </slide>  <slide class="level-2">
    <hgroup>
      <h2>Set Up The Problem<a class="headerlink" href="../../Classes/class-10.html#set-up-the-problem" title="View HTML">§</a></h2>
    </hgroup>
    <article class="">
      <blockquote>
<div><ul class="simple">
<li>goal: merge the information from the 2 files.</li>
<li>we will add info from sample-seq-info.csv to sample-lab-info.tsv</li>
<li>sample-seq-info.csv contains a super-set of the samples in
sample-lab-info.csv</li>
<li>we will match samples by the <cite>Sample</cite> column in sample-lab-info.tsv to
the <cite>Sample ID</cite> column in sample-seq-info.csv<ul>
<li>we will store rows from sample-seq-info.csv in a dictionary keyed by
<cite>Sample ID</cite></li>
</ul>
</li>
<li>since we are <strong>adding</strong> to sample-lab-info.tsv, we don't need to filter
out as we read from sample-seq-info.csv</li>
</ul>
</div></blockquote>




    </article>
  </slide>  <slide class="level-2">
    <hgroup>
      <h2>Understand The Problem<a class="headerlink" href="../../Classes/class-10.html#understand-the-problem" title="View HTML">§</a></h2>
    </hgroup>
    <article class="">
      <p>This is important!!</p>
<p>Any questions on file formats or our strategy?</p>




    </article>
  </slide>  <slide class="level-2">
    <hgroup>
      <h2>Decide on Coding Strategy<a class="headerlink" href="../../Classes/class-10.html#decide-on-coding-strategy" title="View HTML">§</a></h2>
    </hgroup>
    <article class="">
      <ol class="arabic simple">
<li>read from <cite>sample-seq-info.csv</cite> into a dictionary with
keys of <cite>Sample ID</cite> and values (dicts) with the data for that sample. We
This dictionary is <strong>seq_infos</strong>. (skip header while fields[0] != &quot;Lane&quot;)</li>
<li>loop (stream) over <cite>sample-lab-info.tsv</cite> to get <strong>lab_info</strong>
for each sample<ol class="arabic">
<li>Find matching <em>sequence-info</em> for each row by using the <cite>Sample</cite> column as a
key into <strong>seq_infos</strong></li>
<li>The corresponding value of seq_infos[sample] will be all of the laboratory
information for that sample.</li>
<li>Add the <em>seq_info</em> for the current sample to the <em>lab_info</em> using:
<cite>lab_info.update(seq_info)</cite></li>
<li>print out the <strong>lab_info</strong> with newly added <strong>seq_info</strong></li>
</ol>
</li>
</ol>




    </article>
  </slide>  <slide class="level-2">
    <hgroup>
      <h2>Script<a class="headerlink" href="../../Classes/class-10.html#script" title="View HTML">§</a></h2>
    </hgroup>
    <article class="">
      <p>coming slides will go over the script block-by-block before viewing /
running / modifying the entire script.</p>




    </article>
  </slide>  <slide class="level-2">
    <hgroup>
      <h2>Script: Read seq info into dictionary<a class="headerlink" href="../../Classes/class-10.html#script-read-seq-info-into-dictionary" title="View HTML">§</a></h2>
    </hgroup>
    <article class="">
      <div class="highlight-python"><div class="highlight"><pre><span class="c"># store data for all samples here, keys of sample-id, values of info</span>
<span class="n">seq_infos</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c"># loop over each sample in seq_info</span>
<span class="k">for</span> <span class="n">si</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">(</span><span class="n">seq_file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s">&quot;,&quot;</span><span class="p">,</span>
                 <span class="n">skip_while</span><span class="o">=</span><span class="n">is_extra_lines</span><span class="p">):</span>
    <span class="n">sample_id</span> <span class="o">=</span> <span class="n">si</span><span class="p">[</span><span class="s">&#39;Sample ID&#39;</span><span class="p">]</span>
    <span class="n">seq_infos</span><span class="p">[</span><span class="n">sample_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">si</span>
</pre></div>
</div>
<p>Now we have a dictionary with keys of sample ids and values of
dictionaries containing the information for each sample.</p>
<p>We will use this as a lookup-table so that, given a sample_id from the
<strong>lab_info</strong> we can find the associated <strong>seq_info</strong></p>




    </article>
  </slide>  <slide class="level-2">
    <hgroup>
      <h2>Script: Iterate over lab-info and add seq-info<a class="headerlink" href="../../Classes/class-10.html#script-iterate-over-lab-info-and-add-seq-info" title="View HTML">§</a></h2>
    </hgroup>
    <article class="">
      <p>We skip some error checking steps here for simplicity</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">is_first_line</span> <span class="o">=</span> <span class="bp">True</span>

<span class="k">for</span> <span class="n">lab_info</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">(</span><span class="n">lab_file</span><span class="p">):</span>
    <span class="n">sample_id</span> <span class="o">=</span> <span class="n">lab_info</span><span class="p">[</span><span class="s">&#39;Sample&#39;</span><span class="p">]</span>

    <span class="c"># we will add more logic here in the real script.</span>
    <span class="n">seq_info</span> <span class="o">=</span> <span class="n">seq_infos</span><span class="p">[</span><span class="n">sample_id</span><span class="p">]</span>
    <span class="n">lab_info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">seq_info</span><span class="p">)</span>
    <span class="c"># now lab_info has the sequene and the lab keys and values.</span>

    <span class="k">if</span> <span class="n">is_first_line</span><span class="p">:</span> <span class="c"># print a header once only.</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lab_info</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">is_first_line</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="c"># this will print out the data for each record.</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lab_info</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</pre></div>
</div>




    </article>
  </slide>  <slide class="level-2">
    <hgroup>
      <h2>Script: Run<a class="headerlink" href="../../Classes/class-10.html#script-run" title="View HTML">§</a></h2>
    </hgroup>
    <article class="">
      <p>Let's run the script and see what comes out</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>python example-merge.py &gt; merged.tsv
</pre></div>
</div>
<p>look at merged info with <cite>less</cite> and verify that it has columns from
sample-lab-info.csv and sample-seq-info.csv</p>




    </article>
  </slide>  <slide class="level-2">
    <hgroup>
      <h2>Script: Gedit<a class="headerlink" href="../../Classes/class-10.html#script-gedit" title="View HTML">§</a></h2>
    </hgroup>
    <article class="">
      <p>Now let's open the script in gedit and go through it line-by-line!!</p>




    </article>
  </slide>  <slide class="level-2">
    <hgroup>
      <h2>Script: Debug<a class="headerlink" href="../../Classes/class-10.html#script-debug" title="View HTML">§</a></h2>
    </hgroup>
    <article class="">
      <p>We can run the script from <strong>ipython</strong> as</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1]: </span><span class="o">%</span><span class="k">run</span> <span class="n">sample</span><span class="o">-</span><span class="n">merge</span><span class="o">.</span><span class="n">py</span>
<span class="go">ERROR: File `u&#39;sample-merge.py&#39;` not found.</span>
</pre></div>
</div>
<p>Open a gedit window and add some print statements to the script, followed by
&quot;1/0&quot; so that the script will stop and you can see what was printed. Save, then
run from ipython window.</p>
<p>This is a quick way to follow the flow of a script. As you understand each part,
move the print statement and the 1/0 further on in the script.</p>
<p>Spend the rest of class breaking, fixing and understanding this script.</p>




    </article>
  </slide>


    <slide class="thank-you-slide segue nobackground">
    <aside class="gdbar right"><img src="images/google_developers_icon_128.png"></aside>
    <article class="flexbox vleft auto-fadein">
      <h2>&lt;Thank You!&gt;</h2>
    </article>
    <p class="auto-fadein" data-config-contact>
      <!-- populated from slide_config.json -->
    </p>
  </slide>

  <slide class="backdrop"></slide>

</slides>

<!--[if IE]>
  <script src="http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js"></script>
  <script>CFInstall.check({mode: 'overlay'});</script>
<![endif]-->
</body>
</html>