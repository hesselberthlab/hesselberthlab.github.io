

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Class 6 : Working in a cluster environment (part 2) &mdash; Genome Informatics Workshop 0.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  

    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'../',
        VERSION:'0.1',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  true
      };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
    <link rel="top" title="Genome Informatics Workshop 0.1 documentation" href="../index.html"/>
        <link rel="up" title="Class list" href="../Classes.html"/>
        <link rel="next" title="Class 7 : Python : Basics" href="class-7.html"/>
        <link rel="prev" title="Class 5 : Working in a cluster environment" href="class-5.html"/> 

<!-- Google Analytics tracking code -->
<!--        DO NOT REMOVE           -->
<!--           JRH                  -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-47837611-1', 'ucd-bioworkshop.github.io');
  ga('send', 'pageview');

</script>



  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="icon icon-home"> Genome Informatics Workshop</a>
        <form class="wy-form" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search docs" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Syllabus.html">Syllabus (MOLB FIXME)</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../Classes.html">Class list</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="class-1.html">Class 1 : Virtual Machine (VM) and Linux Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="class-2.html">Class 2 : The command-line</a></li>
<li class="toctree-l2"><a class="reference internal" href="class-3.html">Class 3 : The command-line (part 2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="class-4.html">Class 4 : awk</a></li>
<li class="toctree-l2"><a class="reference internal" href="class-5.html">Class 5 : Working in a cluster environment</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Class 6 : Working in a cluster environment (part 2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="class-7.html">Class 7 : Python : Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="class-8.html">Class 8 : Python : Basics (2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="class-9.html">Class 9 : Python Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="class-10.html">Class 10 : Applied Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="class-11.html">Class 11 : Python Idioms</a></li>
<li class="toctree-l2"><a class="reference internal" href="class-12.html">Class 12 : The ENCODE Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="class-13.html">Class 13 : BEDtools</a></li>
<li class="toctree-l2"><a class="reference internal" href="class-14.html">Class 14 : ChIP-seq</a></li>
<li class="toctree-l2"><a class="reference internal" href="class-15.html">Class 15 : ChIP-seq / DNase I</a></li>
<li class="toctree-l2"><a class="reference internal" href="class-16.html">Class 16: Genomic Analysis Vignettes</a></li>
<li class="toctree-l2"><a class="reference internal" href="class-17.html">Class 17 : Bash and Bam</a></li>
<li class="toctree-l2"><a class="reference internal" href="class-18.html">Class 18 : R : Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="class-19.html">Class 19 : R : Manipulation &amp; Plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="class-20.html">Class 20 : R : Manipulation &amp; Plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="class-21.html">Class 21 : R : DataFrames &amp; Plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="class-22.html">Class 22 : R : Data Manipulation &amp; Plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="class-23.html">Class 23 : RNA-Seq I</a></li>
<li class="toctree-l2"><a class="reference internal" href="class-24.html">Class 24 : RNA-Seq II</a></li>
<li class="toctree-l2"><a class="reference internal" href="class-25.html">Class 25 : Exome-Seq - Alignment</a></li>
<li class="toctree-l2"><a class="reference internal" href="class-26.html">Class 26 : Exome-Seq - Variants</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Problem_Sets.html">Problem Sets</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../Problem_Sets/problem_set_1/problem_set_1.html">Problem Set 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Problem_Sets/problem_set_2/problem_set_2.html">Problem Set 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Problem_Sets/problem_set_3/problem_set_3.html">Problem Set 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Problem_Sets/problem_set_4/problem_set_4.html">Problem Set 4</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Problem_Sets/problem_set_5/problem_set_5.html">Problem Set 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Problem_Sets/problem_set_6/problem_set_6.html">Problem Set 6</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Problem_Sets/Problem_Set_Keys.html">Problem Set : KEYS</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Miscellaneous.html">Miscellaneous</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../misc/commands.html">Reference: list of commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../misc/data.html">Sample Data files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../misc/tips.html">Programming Tips &amp; Tricks</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="/">Genome Informatics Workshop</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <ul class="wy-breadcrumbs">
  <li><a href="../index.html">Docs</a> &raquo;</li>
  <li><a href="">Class 6 : Working in a cluster environment (part 2)</a></li>
  
</ul>
<hr/>

          
  <div class="section" id="class-6-working-in-a-cluster-environment-part-2">
<h1>Class 6 : Working in a cluster environment (part 2)<a class="headerlink" href="#class-6-working-in-a-cluster-environment-part-2" title="Permalink to this headline">¶</a><a class="headerlink" href="../slides/Classes/class-6.html#class-6-working-in-a-cluster-environment-part-2" title="Slides">§</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Class date:</th><td class="field-body">Friday 7 February 2014</td>
</tr>
</tbody>
</table>
<div class="section" id="goals">
<h2>Goals<a class="headerlink" href="#goals" title="Permalink to this headline">¶</a><a class="headerlink" href="../slides/Classes/class-6.html#goals" title="Slides">§</a></h2>
<ol class="arabic simple">
<li>Leverage cluster resources to solve bioinformatic problems</li>
<li>Exercises! (<tt class="docutils literal"><span class="pre">grep</span></tt> review)</li>
<li>Practice typing for a bit.</li>
<li>Learn to switch between terminal windows with &lt;Alt&gt;-&lt;Tab&gt;</li>
</ol>
</div>
<div class="section" id="note">
<h2>Note<a class="headerlink" href="#note" title="Permalink to this headline">¶</a><a class="headerlink" href="../slides/Classes/class-6.html#note" title="Slides">§</a></h2>
<p>We would like to quickly move toward having your homework be executable.
In other words, we should be able to:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>bash run.homework-1.sh
</pre></div>
</div>
<p>and have it execute all of the questions, writing results into files into
the right places as necessary. Getting into this habit lets you save
everything you did, and also re-run things when you need to make changes.</p>
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a><a class="headerlink" href="../slides/Classes/class-6.html#overview" title="Slides">§</a></h2>
<p>We will go over a common scenario in bioinformatics where you can
leverage cluster resources to process many files simultaneously with
identical workflows.</p>
</div>
<div class="section" id="exercise">
<h2>Exercise<a class="headerlink" href="#exercise" title="Permalink to this headline">¶</a><a class="headerlink" href="../slides/Classes/class-6.html#exercise" title="Slides">§</a></h2>
<p>Sequencing experiments typically generate raw sequencing data from many
different experimental conditions (i.e. treatments, controls, cell types,
time points, etc.) However, the initial steps of processing sequencing
data use common steps to process the data into an interpretable form. A
typical workflow for assessing sequencing data might begin with:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Align reads to a reference genome</li>
<li>Calculate coverage from the alignment</li>
</ol>
</div></blockquote>
<p>Login to amc-tesla.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># the -X flag starts an X11 connection</span>
<span class="nv">$ </span>ssh -X username@amc-tesla.ucdenver.pvt
</pre></div>
</div>
<p>We have 4 different FASTQ files from a sequencing experiment. They
are located in:</p>
<div class="highlight-python"><div class="highlight"><pre>/vol1/opt/data
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Type this out. Do not copy / paste.</p>
</div>
<div class="highlight-bash"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#! /usr/bin/env bash</span>

<span class="c">#BSUB -J workflow[1-4]                                                                                                              </span>
<span class="c">#BSUB -e %J.%I.err                                                                                                                  </span>
<span class="c">#BSUB -o %J.%I.out                                                                                                                  </span>
<span class="c">#BSUB -R &quot;select[mem&gt;4] rusage[mem=4]&quot;</span>

<span class="c"># this section defines the sample names and grabs the appropriate                                                                   </span>
<span class="c"># sample name for the current process</span>
<span class="nv">SAMPLENAMES</span><span class="o">=(</span>SP1 SP2 SP3 SP4<span class="o">)</span>                                                                                                       

<span class="c"># $LSB_JOBINDEX is set at runtime for the current process; in this                                                                  </span>
<span class="c"># case you asked for 4 jobs, so it be a value between 1 and 4                                                                       </span>
<span class="nv">sample</span><span class="o">=</span><span class="k">${</span><span class="nv">SAMPLENAMES</span><span class="p">[</span><span class="k">$((</span><span class="nv">$LSB_JOBINDEX</span> <span class="o">-</span> <span class="m">1</span><span class="k">))</span><span class="p">]</span><span class="k">}</span>                                                                                       

<span class="c"># set up file names                                                                                                                 </span>
<span class="nv">data</span><span class="o">=</span>/vol1/opt/data
<span class="nv">bwtindex</span><span class="o">=</span>/vol1/opt/data/hg19
<span class="nv">fastq</span><span class="o">=</span><span class="nv">$data</span>/<span class="nv">$sample</span>.fq.gz
<span class="nv">align</span><span class="o">=</span><span class="nv">$sample</span>.sam
<span class="nv">coverage</span><span class="o">=</span><span class="nv">$sample</span>.coverage.gz

<span class="c"># run the workflow </span>
bowtie2 -x <span class="nv">$bwtindex</span> -U <span class="nv">$fastq</span> &gt; <span class="nv">$align</span>

<span class="c"># now generate counts of each position that was aligned to; fields 3                                                                </span>
<span class="c"># and 4 of the .sam file are chrom and pos.</span>
grep -v <span class="s1">&#39;^@&#39;</span> <span class="nv">$align</span> <span class="se">\</span>
    | cut -f3,4 <span class="se">\</span>
    | sort <span class="se">\</span>
    | uniq -c <span class="se">\</span>
    | awk <span class="s1">&#39;BEGIN {OFS=&quot;\t&quot;} {print $2,$3,$1}&#39;</span> <span class="se">\</span>
    | gzip -c &gt; <span class="nv">$coverage</span>
</pre></div>
</td></tr></table></div>
<p>Run the above script and check its status immediately:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>bsub &lt; run.sh
<span class="nv">$ </span>bjobs
</pre></div>
</div>
<p>You should see 4 running jobs, each with its own index i.e. workflow[1],
workflow[2] etc.</p>
<p>These will run for a bit. After they are done, you will see several new
files, corresponding to the output of the same analysis applied to all the
different samples.</p>
</div>
<div class="section" id="questions">
<h2>Questions<a class="headerlink" href="#questions" title="Permalink to this headline">¶</a><a class="headerlink" href="../slides/Classes/class-6.html#questions" title="Slides">§</a></h2>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Check the <tt class="docutils literal"><span class="pre">.err</span></tt> files from the run. What information do they
contain? What does this tell you about your starting sequences?</p>
</li>
<li><p class="first">Find out how you would modify the <tt class="docutils literal"><span class="pre">bowtie2</span></tt> command to write out the
unaligned reads into a new file. Re-run the analysis to report those
reads.</p>
</li>
<li><p class="first">Modify the <tt class="docutils literal"><span class="pre">awk</span></tt> command in the script to print out a valid BED4
format:</p>
<p>chrom &lt;tab&gt; start &lt;tab&gt; end &lt;tab&gt; count</p>
</li>
<li><p class="first">Find out how many unique UMI sequences are associted with each
chromosomal coordinate (note: not as easy).</p>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="more-exercises">
<h2>More exercises<a class="headerlink" href="#more-exercises" title="Permalink to this headline">¶</a><a class="headerlink" href="../slides/Classes/class-6.html#more-exercises" title="Slides">§</a></h2>
<blockquote>
<div><ol class="arabic simple">
<li>use <tt class="docutils literal"><span class="pre">grep</span></tt> to identify lines in lamina.bed where the second field
(start) begins with <tt class="docutils literal"><span class="pre">100</span></tt>.</li>
<li>use <tt class="docutils literal"><span class="pre">grep</span></tt> to identify lines in lamina.bed where the third field
(end) ends with 99 .</li>
<li>use <tt class="docutils literal"><span class="pre">grep</span></tt> with its <tt class="docutils literal"><span class="pre">-w</span></tt> flag to count the number of &#8216;chr1&#8217;
records in lamina.bed.</li>
<li>use <tt class="docutils literal"><span class="pre">grep</span></tt> to count how many fastq records are in the
/vol1/opt/data/t_R1.fastq.gz file (fastq records begin with an
&#8216;&#64;&#8217; symbol)</li>
<li>login to amc-tesla. use <tt class="docutils literal"><span class="pre">grep</span></tt> to count the number of fastq records
in /vol1/opt/data/SP1.fq.gz</li>
</ol>
</div></blockquote>
</div>
</div>


          <footer>
  
    <div class="rst-footer-buttons">
      
        <a href="class-7.html" class="btn btn-neutral float-right" title="Class 7 : Python : Basics"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="class-5.html" class="btn btn-neutral" title="Class 5 : Working in a cluster environment"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <p>
      &copy; Copyright 2014, Brent Pedersen, Jay Hesselberth.
    Last updated on Aug 25, 2014.
  </p>

  <a href="https://www.github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="http://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  

</body>
</html>