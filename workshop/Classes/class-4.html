<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Class 4 : awk &mdash; Genome Informatics Workshop 0.2 documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.1.0/flatly/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="Genome Informatics Workshop 0.2 documentation" href="../index.html" />
    <link rel="up" title="Class list" href="../Classes.html" />
    <link rel="next" title="Class 5 : Working in a cluster environment" href="class-5.html" />
    <link rel="prev" title="Class 3 : The command-line (part 2)" href="class-3.html" /> 

<!-- Google Analytics tracking code -->
<!--        DO NOT REMOVE           -->
<!--           JRH                  -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-47837611-1', 'ucd-bioworkshop.github.io');
  ga('send', 'pageview');

</script>


  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html"><img src="../_static/my_logo.png">
          Genome Informatics Workshop</a>
        <span class="navbar-text navbar-version pull-left"><b>0.2</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
                <li><a href="http://hesselberthlab.github.io">Hesselberth lab</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Genome Informatics Workshop <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Syllabus.html">Syllabus</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../Classes.html">Class list</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Problem_Sets.html">Problem Sets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Miscellaneous.html">Miscellaneous</a></li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">Class 4 : awk</a><ul>
<li><a class="reference internal" href="#goals">Goals</a></li>
<li><a class="reference internal" href="#review">Review</a><ul>
<li><a class="reference internal" href="#awk">awk</a></li>
</ul>
</li>
<li><a class="reference internal" href="#basic-principles">basic principles</a></li>
<li><a class="reference internal" href="#awk-program-structure">awk program structure</a></li>
<li><a class="reference internal" href="#awk-begin">awk BEGIN</a></li>
<li><a class="reference internal" href="#filtering">filtering</a></li>
<li><a class="reference internal" href="#program-structure">program structure</a></li>
<li><a class="reference internal" href="#in-class-exercise">in-class exercise</a></li>
<li><a class="reference internal" href="#awk-program-structure-actions">awk program structure (actions)</a></li>
<li><a class="reference internal" href="#id1">in-class exercise</a></li>
<li><a class="reference internal" href="#awk-continued">awk continued</a></li>
<li><a class="reference internal" href="#awk-special-variables">awk special variables</a></li>
<li><a class="reference internal" href="#using-awk-to-count-lines-with-nr">using awk to count lines with NR</a></li>
<li><a class="reference internal" href="#using-fs-and-ofs">using FS and OFS</a></li>
<li><a class="reference internal" href="#regular-expressions">regular expressions</a></li>
<li><a class="reference internal" href="#advanced-awk">advanced awk</a></li>
<li><a class="reference internal" href="#in-class-exercises-class-4">In Class Exercises - Class 4</a></li>
<li><a class="reference internal" href="#id2">review</a></li>
<li><a class="reference internal" href="#in-class-exercises-class-4-2">In Class Exercises - Class 4 (2)</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    <div class="col-md-9">
      
  <div class="section" id="class-4-awk">
<h1>Class 4 : awk<a class="headerlink" href="#class-4-awk" title="Permalink to this headline">¶</a><a class="headerlink" href="../slides/Classes/class-4.html#class-4-awk" title="Slides">§</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Class date:</th><td class="field-body">Monday 3 February 2014</td>
</tr>
</tbody>
</table>
<div class="section" id="goals">
<h2>Goals<a class="headerlink" href="#goals" title="Permalink to this headline">¶</a><a class="headerlink" href="../slides/Classes/class-4.html#goals" title="Slides">§</a></h2>
<ol class="arabic simple">
<li>Review</li>
<li>remember BED format (chr, start, end)</li>
<li>learn awk basics to filter and manipulate text</li>
</ol>
</div>
<div class="section" id="review">
<h2>Review<a class="headerlink" href="#review" title="Permalink to this headline">¶</a><a class="headerlink" href="../slides/Classes/class-4.html#review" title="Slides">§</a></h2>
<blockquote>
<div>what we&#8217;ve learned</div></blockquote>
<div class="section" id="awk">
<h3>awk<a class="headerlink" href="#awk" title="Permalink to this headline">¶</a><a class="headerlink" href="../slides/Classes/class-4.html#awk" title="Slides">§</a></h3>
<p><a class="reference external" href="http://en.wikipedia.org/wiki/AWK">http://en.wikipedia.org/wiki/AWK</a></p>
<p><tt class="docutils literal"><span class="pre">AWK</span></tt> is an interpreted <strong>programming language</strong> designed for text
processing and typically used as a data extraction and reporting tool. It
is a standard feature of most Unix-like operating systems.</p>
<p>Named after authors <strong>A</strong> ho, <strong>W</strong> einberger &amp; <strong>K</strong> ernighan</p>
<p><strong>This is programming</strong></p>
</div>
</div>
<div class="section" id="basic-principles">
<h2>basic principles<a class="headerlink" href="#basic-principles" title="Permalink to this headline">¶</a><a class="headerlink" href="../slides/Classes/class-4.html#basic-principles" title="Slides">§</a></h2>
<blockquote>
<div><ol class="arabic simple">
<li>awk operates on each line of a text file</li>
<li>in an awk program, $1 is an alias for the 1st column, $2 for the 2nd, etc.</li>
<li>awk can filter lines by a pattern</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="awk-program-structure">
<h2>awk program structure<a class="headerlink" href="#awk-program-structure" title="Permalink to this headline">¶</a><a class="headerlink" href="../slides/Classes/class-4.html#awk-program-structure" title="Slides">§</a></h2>
<blockquote>
<div><ul class="simple">
<li><strong>BEGIN</strong> runs before the program starts</li>
<li><strong>END</strong> runs after the program runs through all lines in the file</li>
<li><strong>PATTERN</strong> and <strong>ACTIONS</strong> check and execute on each line.</li>
</ul>
</div></blockquote>
<div class="highlight-bash"><div class="highlight"><pre>awk <span class="s1">&#39;BEGIN {} (PATTERN) { ACTIONS } END {}&#39;</span> some.file.txt
</pre></div>
</div>
</div>
<div class="section" id="awk-begin">
<h2>awk BEGIN<a class="headerlink" href="#awk-begin" title="Permalink to this headline">¶</a><a class="headerlink" href="../slides/Classes/class-4.html#awk-begin" title="Slides">§</a></h2>
<p>Using begin, we don&#8217;t need a file. We just do one thing then exit:</p>
<div class="highlight-bash"><div class="highlight"><pre>awk <span class="s1">&#39;BEGIN { print 12 * 12 }&#39;</span>
</pre></div>
</div>
<p>Same with <strong>END</strong>:</p>
<div class="highlight-bash"><div class="highlight"><pre>awk <span class="s1">&#39;END { print 12 * 13 }&#39;</span> <span class="c"># then type ctrl+d so it knows it&#39;s not getting more input.</span>
</pre></div>
</div>
</div>
<div class="section" id="filtering">
<h2>filtering<a class="headerlink" href="#filtering" title="Permalink to this headline">¶</a><a class="headerlink" href="../slides/Classes/class-4.html#filtering" title="Slides">§</a></h2>
<p>A simple and powerful use of awk is lines that match a pattern or meet set
of criteria. Here, we match (and implicitly print) only lines where the
first column is chr12:</p>
<div class="highlight-bash"><div class="highlight"><pre>awk <span class="s1">&#39;($1 == &quot;chr12&quot;)&#39;</span> /opt/bio-workshop/data/lamina.bed
</pre></div>
</div>
<p>We can also filter on start position using &#8216;&amp;&amp;&#8217; which means &#8216;and&#8217;:</p>
<div class="highlight-bash"><div class="highlight"><pre>awk <span class="s1">&#39;($1 == &quot;chr12&quot; &amp;&amp; $2 &lt; 9599990)&#39;</span> /opt/bio-workshop/data/lamina.bed
</pre></div>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p><tt class="docutils literal"><span class="pre">=</span></tt> and <tt class="docutils literal"><span class="pre">==</span></tt> are not the same thing, and are frequently mixed up.</p>
<p class="last"><tt class="docutils literal"><span class="pre">=</span></tt> is the assignment operator
<tt class="docutils literal"><span class="pre">==</span></tt> tests for equality
<tt class="docutils literal"><span class="pre">!=</span></tt> tests for inequality.</p>
</div>
</div>
<div class="section" id="program-structure">
<h2>program structure<a class="headerlink" href="#program-structure" title="Permalink to this headline">¶</a><a class="headerlink" href="../slides/Classes/class-4.html#program-structure" title="Slides">§</a></h2>
<div class="highlight-bash"><div class="highlight"><pre>awk <span class="s1">&#39;($1 == &quot;chr12&quot; &amp;&amp; $2 &lt; 9599990)&#39;</span> /opt/bio-workshop/data/lamina.bed
</pre></div>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<ul class="last simple">
<li>when we are checking as a character (&#8220;chr12&#8221;) we need the quotes.</li>
<li>when we are checking as a number (9599990) can not use quotes.</li>
<li>can&#8217;t use commas (e.g. 9,599,990) in numbers</li>
</ul>
</div>
</div>
<div class="section" id="in-class-exercise">
<h2>in-class exercise<a class="headerlink" href="#in-class-exercise" title="Permalink to this headline">¶</a><a class="headerlink" href="../slides/Classes/class-4.html#in-class-exercise" title="Slides">§</a></h2>
<p>we will do the first of these together.</p>
<ol class="arabic simple">
<li>how many regions (lines) in lamina.bed have a start less than 1,234,567 on any chromosome?</li>
<li>how many regions in lamina.bed have a start less than 1,234,567 on chromosome 8?</li>
<li>how many regions (lines) in lamina.bed have a start between 50,000 and 951,000</li>
<li>how many regions in lamina.bed overlap the interval <strong>chr12:5,000,000-6,000,000</strong> ?</li>
</ol>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">the last question is not trivial and understanding it will be useful</p>
</div>
</div>
<div class="section" id="awk-program-structure-actions">
<h2>awk program structure (actions)<a class="headerlink" href="#awk-program-structure-actions" title="Permalink to this headline">¶</a><a class="headerlink" href="../slides/Classes/class-4.html#awk-program-structure-actions" title="Slides">§</a></h2>
<p>print total bases covered on chromosome 13:</p>
<div class="highlight-bash"><div class="highlight"><pre>awk <span class="s1">&#39;($1 == &quot;chr13&quot;) { coverage = coverage + $3 - $2 }</span>
<span class="s1">     END{ print coverage }&#39;</span> /opt/bio-workshop/data/lamina.bed
</pre></div>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<ol class="last arabic simple">
<li>the entire awk program must be wrapped in quotes. Nearly always best to use
single quotes (&#8216;) on the outside.</li>
<li><em>coverage</em> is a variable that stores values; we don&#8217;t use
a $ to access it like we do in bash or like we do for the $1,
$2, ... columns</li>
</ol>
</div>
</div>
<div class="section" id="id1">
<h2>in-class exercise<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a><a class="headerlink" href="../slides/Classes/class-4.html#id1" title="Slides">§</a></h2>
<p>below is how we find coverage for chr13.</p>
<div class="highlight-bash"><div class="highlight"><pre>awk <span class="s1">&#39;($1 == &quot;chr13&quot;) { coverage += $3 - $2 }</span>
<span class="s1">     END{ print coverage }&#39;</span> /opt/bio-workshop/data/lamina.bed
</pre></div>
</div>
<p>how can we find the total coverage for all chromsomes <strong>except</strong> 13?</p>
</div>
<div class="section" id="awk-continued">
<h2>awk continued<a class="headerlink" href="#awk-continued" title="Permalink to this headline">¶</a><a class="headerlink" href="../slides/Classes/class-4.html#awk-continued" title="Slides">§</a></h2>
<p>The <tt class="docutils literal"><span class="pre">$0</span></tt> variable contains the entire line.</p>
<p>multiple patterns</p>
<div class="highlight-bash"><div class="highlight"><pre>awk <span class="s1">&#39;$3 &gt;= 5000 { print $0&quot;\tGREATER&quot; }</span>
<span class="s1">     $3  &lt; 5000   { print $0&quot;\tLESS&quot; }&#39;</span> <span class="se">\</span>
      /opt/bio-workshop/data/states.tab
</pre></div>
</div>
<p>remember we can simply filter to the lines &gt; 5000 with:</p>
<div class="highlight-bash"><div class="highlight"><pre>awk <span class="s1">&#39;$3 &gt;= 5000&#39;</span> /opt/bio-workshop/data/states.tab
</pre></div>
</div>
</div>
<div class="section" id="awk-special-variables">
<h2>awk special variables<a class="headerlink" href="#awk-special-variables" title="Permalink to this headline">¶</a><a class="headerlink" href="../slides/Classes/class-4.html#awk-special-variables" title="Slides">§</a></h2>
<blockquote>
<div><ol class="arabic simple">
<li>we know <em>$1</em>, <em>$2</em>, ... for the column numbers</li>
<li>NR is a special variable that holds the line number</li>
<li>NF is a special variable that holds the number of fields in the line</li>
<li>FS and OFS are the (F)ield and (O)output (F)ield (S)eparators
&#8211;meaning the delimiters (default is any space character)</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="using-awk-to-count-lines-with-nr">
<h2>using awk to count lines with NR<a class="headerlink" href="#using-awk-to-count-lines-with-nr" title="Permalink to this headline">¶</a><a class="headerlink" href="../slides/Classes/class-4.html#using-awk-to-count-lines-with-nr" title="Slides">§</a></h2>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>wc -l /opt/bio-workshop/data/lamina.bed

<span class="nv">$ </span>awk <span class="s1">&#39;END { print NR }&#39;</span> /opt/bio-workshop/data/lamina.bed
</pre></div>
</div>
</div>
<div class="section" id="using-fs-and-ofs">
<h2>using FS and OFS<a class="headerlink" href="#using-fs-and-ofs" title="Permalink to this headline">¶</a><a class="headerlink" href="../slides/Classes/class-4.html#using-fs-and-ofs" title="Slides">§</a></h2>
<p>Let&#8217;s convert lamina.bed to comma-delimited but only for chr12</p>
<p>remember FS is the input separator and OFS is the output delimiter</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>awk <span class="s1">&#39;BEGIN{FS=&quot;\t&quot;; OFS=&quot;,&quot;}</span>
<span class="s1">    ($1 == &quot;chr12&quot;){ print $1,$2,$3 }&#39;</span> /opt/bio-workshop/data/lamina.bed
</pre></div>
</div>
</div>
<div class="section" id="regular-expressions">
<h2>regular expressions<a class="headerlink" href="#regular-expressions" title="Permalink to this headline">¶</a><a class="headerlink" href="../slides/Classes/class-4.html#regular-expressions" title="Slides">§</a></h2>
<p>we won&#8217;t cover these in detail, but you can match on <em>regular expressions</em>.</p>
<p>The following finds lines containing chr2 (chr2, chr20, chr21) in the first column</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>awk <span class="s1">&#39;$1 ~ /chr2/&#39;</span> /opt/bio-workshop/data/lamina.bed
</pre></div>
</div>
<p>Often we can get by without <em>regular expressions</em> but they are extremeley powerful
and available in nearly all programming languages.</p>
</div>
<div class="section" id="advanced-awk">
<h2>advanced awk<a class="headerlink" href="#advanced-awk" title="Permalink to this headline">¶</a><a class="headerlink" href="../slides/Classes/class-4.html#advanced-awk" title="Slides">§</a></h2>
<p>You can do a lot more with awk, here are several resources:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference external" href="http://www.hcs.harvard.edu/~dholland/computers/awk.html">http://www.hcs.harvard.edu/~dholland/computers/awk.html</a></li>
<li><a class="reference external" href="http://doc.infosnel.nl/quickawk.html">http://doc.infosnel.nl/quickawk.html</a></li>
<li><a class="reference external" href="http://www.catonmat.net/download/awk.cheat.sheet.pdf">http://www.catonmat.net/download/awk.cheat.sheet.pdf</a></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="in-class-exercises-class-4">
<span id="class-4-exercises"></span><h2>In Class Exercises - Class 4<a class="headerlink" href="#in-class-exercises-class-4" title="Permalink to this headline">¶</a><a class="headerlink" href="../slides/Classes/class-4.html#in-class-exercises-class-4" title="Slides">§</a></h2>
<p>we will do the first 2. of these together</p>
<ol class="arabic simple">
<li>use NR to print each line of <cite>lamina.bed</cite> <em>preceded</em> by it&#8217;s line number</li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li>do the above, but only for regions on chromosome 12</li>
</ol>
</div></blockquote>
<ol class="arabic simple" start="2">
<li>use NF to see how many columns are in each row of <cite>states.tab</cite></li>
</ol>
<blockquote>
<div><ol class="loweralpha simple">
<li>use sort and uniq -c to see uniq column counts.</li>
<li>why are there 2 numbers?</li>
<li>can you adjust the file separator so that awk thinks all rows have
the same number of columns?</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="id2">
<h2>review<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a><a class="headerlink" href="../slides/Classes/class-4.html#id2" title="Slides">§</a></h2>
<ul class="simple">
<li>$1, $2, $3 (default sep is space)</li>
<li>adjust sep with: OFS=&#8221;t&#8221;; FS=&#8221;,&#8221;</li>
<li>$0 # entire line</li>
</ul>
<div class="highlight-awk"><div class="highlight"><pre><span class="nx">BEGIN</span> <span class="p">{}</span>
<span class="p">(</span><span class="kr">match</span><span class="p">)</span> <span class="p">{</span> <span class="nx">coverage</span> <span class="o">+=</span> <span class="o">$</span><span class="mi">3</span> <span class="o">-</span> <span class="o">$</span><span class="mi">2</span> <span class="p">}</span>
<span class="nx">END</span> <span class="p">{</span> <span class="kr">print</span> <span class="nx">coverage</span> <span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li>NR is line number; NF is number of fields;</li>
<li>BEGIN {} filter { action } END { }</li>
</ul>
</div>
<div class="section" id="in-class-exercises-class-4-2">
<h2>In Class Exercises - Class 4 (2)<a class="headerlink" href="#in-class-exercises-class-4-2" title="Permalink to this headline">¶</a><a class="headerlink" href="../slides/Classes/class-4.html#in-class-exercises-class-4-2" title="Slides">§</a></h2>
<blockquote>
<div><ol class="arabic simple">
<li>are there any regions in <cite>lamina.bed</cite> with start &gt; end?</li>
<li>what is the total coverage [sum of (end - start)] of regions on chr13 in <cite>lamina.bed</cite>?</li>
<li>what is the mean value (4th column) on chromome 3 of <cite>lamina.bed</cite></li>
<li>print out only the header and the entry for colorado in <cite>states.tab</cite></li>
<li>what is the (single-number) sum of all the incomes for <cite>states.tab</cite> with illiteracy rate:
a. less than 0.1?
b. greater than 2?</li>
<li>use NR to filter out the header from <cite>lamina.bed</cite> (hint: what is NR for the header?)</li>
</ol>
</div></blockquote>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../_sources/Classes/class-4.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2014, Brent Pedersen, Jay Hesselberth.<br/>
      Last updated on Aug 28, 2014.<br/>
    </p>
  </div>
</footer>
  </body>
</html>